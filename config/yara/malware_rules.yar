/*
   Règles YARA pour la détection de malware
   Auteur: IRIS Security Team
   Version: 1.0
*/

rule Suspicious_Process_Names {
    meta:
        description = "Détection de noms de processus suspects"
        severity = "high"
        category = "malware"
    strings:
        $a1 = "cmd.exe" nocase
        $a2 = "powershell.exe" nocase
        $a3 = "wscript.exe" nocase
        $a4 = "cscript.exe" nocase
        $a5 = "mshta.exe" nocase
        $a6 = "regsvr32.exe" nocase
        $a7 = "rundll32.exe" nocase
        $a8 = "certutil.exe" nocase
        $a9 = "bitsadmin.exe" nocase
        $a10 = "wmic.exe" nocase
    condition:
        any of them
}

rule Suspicious_Network_Activity {
    meta:
        description = "Détection d'activité réseau suspecte"
        severity = "high"
        category = "network"
    strings:
        $a1 = "tor2web"
        $a2 = "torproject"
        $a3 = "vpn"
        $a4 = "proxy"
        $a5 = "anonymizer"
    condition:
        any of them
}

rule Suspicious_File_Operations {
    meta:
        description = "Détection d'opérations de fichiers suspectes"
        severity = "medium"
        category = "file"
    strings:
        $a1 = "copy" nocase
        $a2 = "move" nocase
        $a3 = "delete" nocase
        $a4 = "remove" nocase
        $a5 = "rename" nocase
    condition:
        any of them
}

rule Suspicious_Registry_Operations {
    meta:
        description = "Détection d'opérations de registre suspectes"
        severity = "high"
        category = "registry"
    strings:
        $a1 = "HKEY_LOCAL_MACHINE" nocase
        $a2 = "HKEY_CURRENT_USER" nocase
        $a3 = "HKEY_CLASSES_ROOT" nocase
        $a4 = "HKEY_USERS" nocase
        $a5 = "HKEY_CURRENT_CONFIG" nocase
    condition:
        any of them
}

rule Suspicious_System_Commands {
    meta:
        description = "Détection de commandes système suspectes"
        severity = "high"
        category = "command"
    strings:
        $a1 = "net user" nocase
        $a2 = "net group" nocase
        $a3 = "net localgroup" nocase
        $a4 = "net share" nocase
        $a5 = "netstat" nocase
        $a6 = "tasklist" nocase
        $a7 = "taskkill" nocase
        $a8 = "ipconfig" nocase
        $a9 = "systeminfo" nocase
        $a10 = "whoami" nocase
    condition:
        any of them
}

rule Suspicious_Process_Injection {
    meta:
        description = "Détection d'injection de processus"
        severity = "critical"
        category = "injection"
    strings:
        $a1 = "VirtualAlloc" nocase
        $a2 = "VirtualProtect" nocase
        $a3 = "WriteProcessMemory" nocase
        $a4 = "CreateRemoteThread" nocase
        $a5 = "LoadLibrary" nocase
    condition:
        any of them
}

rule Suspicious_Network_Protocols {
    meta:
        description = "Détection de protocoles réseau suspects"
        severity = "medium"
        category = "network"
    strings:
        $a1 = "ftp" nocase
        $a2 = "smtp" nocase
        $a3 = "pop3" nocase
        $a4 = "imap" nocase
        $a5 = "irc" nocase
    condition:
        any of them
}

rule Suspicious_File_Extensions {
    meta:
        description = "Détection d'extensions de fichiers suspects"
        severity = "medium"
        category = "file"
    strings:
        $a1 = ".exe" nocase
        $a2 = ".dll" nocase
        $a3 = ".bat" nocase
        $a4 = ".cmd" nocase
        $a5 = ".vbs" nocase
        $a6 = ".js" nocase
        $a7 = ".wsf" nocase
        $a8 = ".hta" nocase
        $a9 = ".scr" nocase
        $a10 = ".pif" nocase
    condition:
        any of them
}

rule Suspicious_Process_Behavior {
    meta:
        description = "Détection de comportements de processus suspects"
        severity = "high"
        category = "behavior"
    strings:
        $a1 = "CreateProcess" nocase
        $a2 = "ShellExecute" nocase
        $a3 = "WinExec" nocase
        $a4 = "system" nocase
        $a5 = "popen" nocase
    condition:
        any of them
}

rule Suspicious_Network_Connections {
    meta:
        description = "Détection de connexions réseau suspectes"
        severity = "high"
        category = "network"
    strings:
        $a1 = "connect" nocase
        $a2 = "bind" nocase
        $a3 = "listen" nocase
        $a4 = "accept" nocase
        $a5 = "send" nocase
        $a6 = "recv" nocase
    condition:
        any of them
} 